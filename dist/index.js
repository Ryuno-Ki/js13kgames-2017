!function(){"use strict";class t{static create(t){const e=document.createElement("canvas");return e.setAttribute("id",t),e.setAttribute("height",`${this.HEIGHT}px`),e.setAttribute("width",`${this.WIDTH}px`),window.document.body.appendChild(e),e}static get HEIGHT(){return 300}static get WIDTH(){return 300}}class e{static coordinationSystemToCenter(e,s){return{x:e-t.WIDTH/2,y:s-t.HEIGHT/2}}static mapCartesianToPolar(t){const{x:e,y:s}=t;return{r:Math.sqrt(Math.pow(e,2)+Math.pow(s,2)),phi:Math.atan2(s,e)}}static mapPolarToCartesian(t){const{r:e,phi:s}=t;return{x:e*Math.cos(s),y:e*Math.sin(s)}}static normaliseAngle(t){return t%(2*Math.PI)}}class s{moveLeft(){this.x-=this.step}moveRight(){this.x+=this.step}moveUp(){this.y-=this.step}moveDown(){this.y+=this.step}render(t){const e=.9*(2*Math.PI);t.beginPath(),t.arc(this.x,this.y,this.radius,0,e),t.fill()}constructor(t,e,s){this.radius=t/2,this.step=5,this.x=e,this.y=s}}class i{handleTouchMove(t){if(!this.xDown||!this.yDown)return;const e=this.handlers,s=t.touches[0].clientX,i=t.touches[0].clientY;this.xDiff=this.xDown-s,this.yDiff=this.yDown-i,Math.abs(this.xDiff)>Math.abs(this.yDiff)?this.xDiff>0?e.onLeft():e.onRight():this.yDiff>0?e.onUp():e.onDown(),this.xDown=null,this.yDown=null}onTouchMove(t){this.handleTouchMove(t)}onTouchStart(t){this.xDown=t.touches[0].clientX,this.yDown=t.touches[0].clientY}run(){const t=this,e=t.onTouchMove;this.element.addEventListener("touchmove",e.bind(t),!1)}constructor(t,e){this.xDown=null,this.yDown=null,this.element=t,this.element.addEventListener("touchstart",this.onTouchStart.bind(this),!1);const{onDown:s,onLeft:i,onRight:n,onUp:o}=e;this.handlers={onDown:s,onLeft:i,onRight:n,onUp:o}}}class n{static randomiseGate(){const t=2*Math.PI,s=0+Math.random()*t;return{end:e.normaliseAngle(s+.1*t),start:s}}render(t,e){const{x:s,y:i}=e;t.beginPath(),t.arc(s,i,this.radius,this.endGate,this.startGate),t.stroke()}constructor(t){const{start:e,end:s}=n.randomiseGate();this.radius=t,this.startGate=e,this.endGate=s}}class o{static get KEYMAP(){return{LEFT:37,UP:38,RIGHT:39,DOWN:40}}static notifyUser(){const t=`Code Red at ${(new Date).toISOString()}!`,e=window.document.createTextNode(t);window.document.body.appendChild(e)}addWall(t){this.walls.push(t)}compareAngle(){const t=this.hero,s=e.mapCartesianToPolar(e.coordinationSystemToCenter(t.x,t.y)),i=s.r+t.radius,n=this.paddingBetweenWalls;return this.walls.filter(t=>!(i-t.radius>n)&&!(t.radius-i>n)).map(t=>{const i=e.normaliseAngle(t.startGate),n=e.normaliseAngle(t.endGate),o=e.normaliseAngle(2*Math.PI-s.phi);return!(i<o&&n>o)}).reduce((t,e)=>t||e)}compareRadii(){const t=this.hero,s=e.mapCartesianToPolar(e.coordinationSystemToCenter(t.x,t.y)),i=s.r+t.radius,n=this.paddingBetweenWalls;return this.walls.map(t=>t.radius).filter(t=>!(i-t>n)&&!(t-i>n)).map(e=>!(s.r-t.radius>e)&&!(s.r+t.radius<e)).reduce((t,e)=>t||e)}detectCollision(){return this.compareAngle()&&this.compareRadii()}draw(){this.detectCollision()&&o.notifyUser();const e=this.context;e.clearRect(0,0,t.WIDTH,t.HEIGHT),this.drawWalls(),this.hero.render(e)}drawWalls(){const e=t.WIDTH/2,s=t.HEIGHT/2;this.walls.forEach(t=>{t.render(this.context,{x:e,y:s})})}init(){[1,2,3,4,5,6].forEach(t=>{const e=new n(t*this.paddingBetweenWalls);this.addWall(e)}),this.registerArrowKeyHandlers(),this.registerSwipeHandlers(),window.requestAnimationFrame(this.update.bind(this))}onKeyDown(t){const e=t.keyCode,s=o.KEYMAP;switch(e){case s.LEFT:this.hero.moveLeft(),t.preventDefault();break;case s.UP:this.hero.moveUp(),t.preventDefault();break;case s.RIGHT:this.hero.moveRight(),t.preventDefault();break;case s.DOWN:this.hero.moveDown(),t.preventDefault();break;default:console.log("Received keyCode",t.keyCode)}window.requestAnimationFrame(this.update.bind(this))}registerArrowKeyHandlers(){window.document.body.addEventListener("keydown",this.onKeyDown,!1)}registerSwipeHandlers(){const t={onDown:()=>{this.hero.moveDown(),window.requestAnimationFrame(this.update.bind(this))},onLeft:()=>{this.hero.moveLeft(),window.requestAnimationFrame(this.update.bind(this))},onRight:()=>{this.hero.moveRight(),window.requestAnimationFrame(this.update.bind(this))},onUp:()=>{this.hero.moveUp(),window.requestAnimationFrame(this.update.bind(this))}};new i(this.element,t).run()}setHero(t){this.hero=t}update(t){const e=t-this.lastUpdateTimestamp,s=e<0;(e>60||s)&&(this.draw(),window.requestAnimationFrame(this.update.bind(this)),this.lastUpdateTimestamp=t)}constructor(e){const i=t.create(e);this.context=i.getContext("2d"),this.element=i;const n=2*Math.PI;this.paddingBetweenWalls=2.7*n,this.hero=new s(this.paddingBetweenWalls/2,t.WIDTH/2,t.HEIGHT/2),this.lastUpdateTimestamp=Number(new Date),this.walls=[]}}new o("game").init()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbXSwic291cmNlc0NvbnRlbnQiOltdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIn0=
